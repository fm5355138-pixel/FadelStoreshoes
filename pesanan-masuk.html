<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pesanan Masuk - Fadel Store Admin</title>
  <style>
    body {background:#0d0d0d; color:#fff; font-family:Arial,sans-serif; margin:0; padding:20px; min-height:100vh;}
    .header {text-align:center; padding:25px; background:#1a1a1a; border-radius:20px; border:3px solid #00ffff; margin-bottom:30px; box-shadow:0 0 20px rgba(0,255,255,0.2);}
    h1 {color:#00ffff; margin:0; font-size:2em;}
    .subtitle {color:#888; font-size:1em; margin-top:10px;}
    .container {max-width:650px; margin:0 auto;}
    .card {
      background:#1c1c1e; border:2px solid #333; border-radius:15px; padding:20px; margin:18px 0;
      position:relative; box-shadow:0 5px 20px rgba(0,0,0,0.5); transition:all 0.3s;
    }
    .card.new {border-color:#00ffff; box-shadow:0 0 30px rgba(0,255,255,0.6); animation:pulse 2s infinite;}
    @keyframes pulse {0%,100%{transform:scale(1)} 50%{transform:scale(1.02)}}
    .badge {position:absolute; top:-12px; left:50%; transform:translateX(-50%); background:#ff4444; color:#fff; padding:8px 25px; border-radius:30px; font-weight:bold; font-size:0.9em; animation:blink 1.5s infinite;}
    @keyframes blink {0%,100%{opacity:1} 50%{opacity:0.6}}
    .id {position:absolute; top:10px; right:15px; background:#00ffff; color:#000; padding:5px 12px; border-radius:20px; font-size:0.8em; font-weight:bold;}
    .info {margin:12px 0;}
    .label {color:#888; font-size:0.95em;}
    .value {color:#2ecc71; font-weight:bold; font-size:1.2em;}
    .detail {background:#111; padding:15px; border-radius:10px; margin:15px 0; white-space:pre-line; font-size:0.95em; max-height:180px; overflow-y:auto; border:1px dashed #444;}
    .btn-group {text-align:center; margin-top:20px;}
    .btn {padding:12px 25px; margin:8px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; font-size:1em;}
    .btn-wa {background:#2ecc71; color:#000;}
    .btn-done {background:#00ffff; color:#000;}
    .empty {text-align:center; padding:80px; color:#888; font-size:1.3em;}
    .footer {text-align:center; margin:50px 0 20px; color:#555;}
    .footer a {color:#00ffff; text-decoration:none; margin:0 15px; font-weight:bold;}
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Pesanan Masuk</h1>
    <p class="subtitle">Semua customer yang sudah klik "Saya Sudah Transfer"</p>
  </div>

  <div id="orderList">
    <div class="empty">Menunggu pesanan masuk...</div>
  </div>

  <div class="footer">
    <a href="view-order.html">Lihat Detail Satu Customer</a> • 
    <a href="dashboard.html">Dashboard</a> • 
    <a href="../index.html">Kembali ke Toko</a>
  </div>
</div>

<script>
function formatRupiah(n) {
  return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
}

function loadOrders() {
  const orders = JSON.parse(localStorage.getItem('admin_orders') || '[]');
  const list = document.getElementById('orderList');
  const urlParams = new URLSearchParams(window.location.search);
  const highlightId = urlParams.get('highlight');

  if (orders.length === 0) {
    list.innerHTML = '<div class="empty">Belum ada pesanan masuk</div>';
    return;
  }

  // Urutkan dari terbaru
  orders.sort((a, b) => b.id - a.id);

  list.innerHTML = orders.map(order => {
    const isNew = highlightId && order.id == highlightId;
    return `
      <div class="card ${isNew ? 'new' : ''}">
        ${isNew ? '<div class="badge">PESANAN BARU!</div>' : ''}
        <div class="id">#${order.id.toString().slice(-6)}</div>

        <div class="info"><div class="label">Nama</div><div class="value">${order.nama}</div></div>
        <div class="info"><div class="label">WhatsApp</div><div class="value">+62${order.nohp}</div></div>
        <div class="info"><div class="label">Total</div><div class="value">${order.total}</div></div>
        <div class="info"><div class="label">Waktu</div><div class="value">${order.waktu}</div></div>

        <div class="label">Detail Pesanan</div>
        <div class="detail">${order.detail}</div>

        <div class="btn-group">
          <button class="btn btn-wa" onclick="chatWA('${order.nohp}', '${order.nama}')">Chat WA</button>
          <button class="btn btn-done" onclick="konfirmasiSelesai(${order.id})">Sudah Dikonfirmasi</button>
        </div>
      </div>
    `;
  }).join('');
}

function chatWA(nohp, nama) {
  const msg = encodeURIComponent(`Halo ${nama}!\nTerima kasih sudah transfer\nOrder kamu sedang kami proses ya!\n\nFadel Store`);
  window.open(`https://wa.me/${nohp}?text=${msg}`, '_blank');
}

function konfirmasiSelesai(id) {
  if (confirm('Order ini sudah selesai & akan dihapus dari daftar?')) {
    let orders = JSON.parse(localStorage.getItem('admin_orders') || '[]');
    orders = orders.filter(o => o.id !== id);
    localStorage.setItem('admin_orders', JSON.stringify(orders));
    loadOrders();
    alert('Order berhasil dikonfirmasi!');
  }
}

// Auto refresh tiap 10 detik + highlight pesanan baru
setInterval(loadOrders, 10000);
window.onload = loadOrders;
</script>

</body>
</html>